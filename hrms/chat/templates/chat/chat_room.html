<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <style>
        #chat-log { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
        #chat-message-input { width: 70%; }
        #chat-message-submit { width: 28%; }
        .right { text-align: right; }
        .left { text-align: left; }
    </style>
</head>
<body>
<h2>Chat Room</h2>
<div id="chat-log"></div>
<input id="chat-message-input" placeholder="Type message" />
<button id="chat-message-submit">Send</button>
<button onclick="joinVideo()">Join Video Room</button>

<script>
const userEmail = "{{ request.user.email }}";
const chatSocket = new WebSocket('ws://' + window.location.host + '/ws/chat/');

chatSocket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    const chatLog = document.querySelector('#chat-log');
    const p = document.createElement('p');
    p.className = (data.fullname === userEmail) ? "right" : "left";
    p.innerHTML = `<strong>${data.fullname}:</strong> ${data.message}`;
    chatLog.appendChild(p);
    chatLog.scrollTop = chatLog.scrollHeight;
};

document.querySelector('#chat-message-submit').onclick = function() {
    const msgInput = document.querySelector('#chat-message-input');
    const msg = msgInput.value;
    chatSocket.send(JSON.stringify({ "message": msg, "email": userEmail }));
    msgInput.value = '';
};

function joinVideo() {
    const code = prompt("Enter 4-digit room code:");
    window.open(`/video/${code}/`, "_blank", "width=800,height=600");
}
</script>
</body>
</html>
